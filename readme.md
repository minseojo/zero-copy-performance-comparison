### [**Zero-Copy 정리 블로그 링크**](https://virtualworld.tistory.com/entry/IO-%EB%B3%91%EB%AA%A9%EC%9D%84-%EC%97%86%EC%95%A0%EB%8A%94-%EB%B0%A9%EB%B2%95-Zero-Copy-feat-sendfile-DMA)

</br>

# Zero-Copy vs Traditional I/O 성능 비교
**기존의 파일 전송 방식(전통적인 방식, read(), write())** 과 **Zero-Copy 방식 (FileChannel.transferTo)** 간의 **성능 차이**를 비교합니다.

</br>

##  목적

- 전송 방식에 따른 CPU 부하, 전송 속도, 캐싱 효과 등의 차이를 정량적으로 확인
- Java NIO의 `transferTo()`가 내부적으로 사용하는 `sendfile()` 시스템 콜의 효과 분석
- 파일 전송에서 Zero-Copy의 캐시 활용 성능 향상 확인

---


## 예제 파일 만드는 법
다음 코드를 이용해서 .bin파일을 만들어서 사용하세요.

```python
sizes_in_mb = [1, 10, 50, 100, 250, 500, 1000]

def create_file(size_mb):
    filename = f"{size_mb}mb.bin"
    size_bytes = size_mb * 1024 * 1024  # MB to Bytes
    with open(filename, "wb") as f:
        f.write(b'\0' * size_bytes)
    print(f"{filename} created ({size_bytes:,} bytes)")

for size in sizes_in_mb:
    create_file(size)
```


## 결과
| **파일 크기** | **기존 방식 (ms)** | **Zero-Copy 최초 (ms)** | **Zero-Copy 캐시 후 (ms)** | **성능 향상** | **캐싱 성능 향상** |
| --- | --- | --- | --- | --- | --- |
| 10MB | 13 | 13 | 8 | 차이 미미 | 약 38% 향상 |
| 50MB | 32 | 25 | 13 | 약 22% 향상 | 약 59% 향상 |
| 100MB | 60 | 46 | 22 | 약 23% 향상 | 약 63% 향상 |
| 250MB | 137 | 100 | 42 | 약 27% 향상 | 약 69% 향상 |
| 500MB | 335 | 234 | 72 | 약 30% 향상 | 약 78% 향상 |
| 1GB | 770 | 526 | 113 | 약 32% 향상 | 약 85% 향상 |

**분석 1. 파일 크기가 커질수록 Zero-Copy의 장점이 커진다**

파일 크기가 커질수록 기존 방식과 Zero-Copy 방식의 성능 차이는 점점 벌어집니다. 특히 500MB 이상의 파일에서는 기존 방식 대비 **최대 30% 이상 빠른 전송 성능**을 보여줍니다. 이는 기존 방식이 사용자 공간을 거쳐 데이터를 복사하기 때문에 **복사 비용 + 컨텍스트 스위치 비용**이 누적되지만, Zero-Copy는 **커널 내에서 복사 없이 소켓으로 직접 전송**하기 때문입니다.

</br>

**분석 2. 반복 전송 시, 페이지 캐시가 적용된다.**

Zero-Copy는 **최초 전송 시에는 디스크 I/O 비용**이 발생하지만, 이후 동일한 파일을 다시 전송할 때는 페이지 캐시에 적재된 데이터를 활용해 **디스크 접근 없이 바로 전송**합니다.
즉, 전송 속도는 디스크 속도가 아니라 **메모리 속도 + 네트워크 대역폭에 의해 결정**됩니다.

</br>

**1GB 파일의 경우,**
-   기존 방식: 770 ms
-   Zero-Copy 최초 전송: 234 ms
-   Zero-Copy 반복 전송: 72ms (페이지 캐시)  
    → **CPU 복사 없이, 디스크 접근도 없이** 빠르게 처리됨을 알 수 있습니다.

</br>

**Zero-Copy에서 페이지 캐싱이 효과적인 이유**
1.  **최초 요청 시**: 디스크에서 데이터를 읽어 메모리(페이지 캐시)에 적재 → 느림
2.  **반복 요청 시**: 이미 캐시에 올라와 있는 데이터를 그대로 사용 → 빠름
3.  **Zero-Copy는 커널 페이지 캐시에서 직접 네트워크로 전송 가능**  
    → 사용자 공간으로 복사하지 않기 때문에 **CPU 자원 소모 없이 고속 전송** 가능
대부분의 서버 I/O는 단순해 보이지만, 그 이면에서는 수많은 복사와 전송이 CPU 자원을 소모합니다.

Zero-Copy는 다음과 같이 불필요한 오버헤드를 줄여, **더 적은 CPU 자원으로 더 많은 네트워크 전송량**을 처리할 수 있게 해줍니다.
-   **CPU 사용량 감소**
-   **디스크 접근 최소화**
-   **파일 크기 증가에도 높은 전송 효율 유지**
